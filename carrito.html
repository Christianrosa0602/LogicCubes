<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mi carrito</title>
  <link rel="stylesheet" href="css/carrito.css">
</head>
<body>
  <header>
    <h1>Carrito de compras</h1>
    <a href="index.html">Regresar</a>
  </header>

  <div id="lista-carrito"></div>
  <h3 id="total">Total: $0</h3>
  <button id="vaciar" onclick="vaciarCarrito()">Vaciar carrito</button>
  <button id="finalizarCompra" onclick="finalizarCompra()">Finalizar Compra</button>

  <script>
    // Obtener usuario activo de localStorage
    const usuarioActivo = JSON.parse(localStorage.getItem("usuarioActivo"));

    // Si no hay usuario activo, redirigir a login
    if (!usuarioActivo) {
      alert("Debes iniciar sesión para ver tu carrito.");
      window.location.href = "login.html";
    }

    // Definir clave para carrito por usuario
    const claveCarrito = `carrito_${usuarioActivo.correo}`;

    // Obtener carrito específico del usuario activo
    let carrito = JSON.parse(localStorage.getItem(claveCarrito)) || [];

    const contenedor = document.getElementById("lista-carrito");
    const totalElement = document.getElementById("total");

    function mostrarCarrito() {
      contenedor.innerHTML = "";
      let total = 0;

      if (carrito.length === 0) {
        contenedor.innerHTML = "<p>No hay productos en el carrito.</p>";
        totalElement.textContent = "Total: $0";
        return;
      }

      carrito.forEach((producto, index) => {
        const item = document.createElement("div");
        item.className = "button";
        item.innerHTML = `
          <p>${producto.nombre} - $${producto.precio}</p>
          <button onclick="eliminarProducto(${index})">Eliminar</button>
        `;
        contenedor.appendChild(item);
        total += producto.precio;
      });

      totalElement.textContent = `Total: $${total}`;
    }

    function eliminarProducto(indice) {
      carrito.splice(indice, 1);
      localStorage.setItem(claveCarrito, JSON.stringify(carrito));
      mostrarCarrito();
    }

    function vaciarCarrito() {
      localStorage.removeItem(claveCarrito);
      carrito = [];
      mostrarCarrito();
    }

    mostrarCarrito(); // Llamar al cargar la página

    function finalizarCompra() {
      const confirmar = confirm("¿Estás seguro de finalizar la compra?");
      if (confirmar) {
        localStorage.removeItem(claveCarrito);
        carrito = [];
        mostrarCarrito();
        alert("¡Gracias por tu compra!");
        window.location.href = "index.html";
      }
    }
  </script>
</body>
</html>
